{"ast":null,"code":"import { __assign, __awaiter, __extends, __generator, __spreadArray } from \"tslib\";\nimport { resolveAliasArguments, resolveArguments, resolvePageArguments, resolveUserArguments } from '../arguments-resolver';\nimport { invokeCallback } from '../callback';\nimport { isOffline } from '../connection';\nimport { Context } from '../context';\nimport { Emitter } from '@segment/analytics-core';\nimport { EventFactory } from '../events';\nimport { EventQueue } from '../queue/event-queue';\nimport { Group, User } from '../user';\nimport autoBind from '../../lib/bind-all';\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted';\nimport { version } from '../../generated/version';\nimport { PriorityQueue } from '../../lib/priority-queue';\nimport { getGlobal } from '../../lib/get-global';\nimport { inspectorHost } from '../inspector';\nvar deprecationWarning = 'This is being deprecated and will be not be available in future releases of Analytics JS'; // reference any pre-existing \"analytics\" object so a user can restore the reference\n\nvar global = getGlobal();\n\nvar _analytics = global === null || global === void 0 ? void 0 : global.analytics;\n\nfunction createDefaultQueue(retryQueue, disablePersistance) {\n  if (retryQueue === void 0) {\n    retryQueue = false;\n  }\n\n  if (disablePersistance === void 0) {\n    disablePersistance = false;\n  }\n\n  var maxAttempts = retryQueue ? 4 : 1;\n  var priorityQueue = disablePersistance ? new PriorityQueue(maxAttempts, []) : new PersistedPriorityQueue(maxAttempts, 'event-queue');\n  return new EventQueue(priorityQueue);\n}\n/* analytics-classic stubs */\n\n\nfunction _stub() {\n  console.warn(deprecationWarning);\n}\n\nvar Analytics =\n/** @class */\nfunction (_super) {\n  __extends(Analytics, _super);\n\n  function Analytics(settings, options, queue, user, group) {\n    var _this = this;\n\n    var _a, _b, _c;\n\n    _this = _super.call(this) || this;\n    _this._debug = false;\n    _this.initialized = false;\n\n    _this.user = function () {\n      return _this._user;\n    };\n\n    _this.init = _this.initialize.bind(_this);\n    _this.log = _stub;\n    _this.addIntegrationMiddleware = _stub;\n    _this.listeners = _stub;\n    _this.addEventListener = _stub;\n    _this.removeAllListeners = _stub;\n    _this.removeListener = _stub;\n    _this.removeEventListener = _stub;\n    _this.hasListeners = _stub;\n    _this.add = _stub;\n    _this.addIntegration = _stub;\n    var cookieOptions = options === null || options === void 0 ? void 0 : options.cookie;\n    var disablePersistance = (_a = options === null || options === void 0 ? void 0 : options.disableClientPersistence) !== null && _a !== void 0 ? _a : false;\n    _this.settings = settings;\n    _this.settings.timeout = (_b = _this.settings.timeout) !== null && _b !== void 0 ? _b : 300;\n    _this.queue = queue !== null && queue !== void 0 ? queue : createDefaultQueue(options === null || options === void 0 ? void 0 : options.retryQueue, disablePersistance);\n    _this._user = user !== null && user !== void 0 ? user : new User(disablePersistance ? __assign(__assign({}, options === null || options === void 0 ? void 0 : options.user), {\n      persist: false\n    }) : options === null || options === void 0 ? void 0 : options.user, cookieOptions).load();\n    _this._group = group !== null && group !== void 0 ? group : new Group(disablePersistance ? __assign(__assign({}, options === null || options === void 0 ? void 0 : options.group), {\n      persist: false\n    }) : options === null || options === void 0 ? void 0 : options.group, cookieOptions).load();\n    _this.eventFactory = new EventFactory(_this._user);\n    _this.integrations = (_c = options === null || options === void 0 ? void 0 : options.integrations) !== null && _c !== void 0 ? _c : {};\n    _this.options = options !== null && options !== void 0 ? options : {};\n    autoBind(_this);\n    return _this;\n  }\n\n  Analytics.prototype.track = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, name, data, opts, cb, segmentEvent;\n\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        _a = resolveArguments.apply(void 0, args), name = _a[0], data = _a[1], opts = _a[2], cb = _a[3];\n        segmentEvent = this.eventFactory.track(name, data, opts, this.integrations);\n        return [2\n        /*return*/\n        , this.dispatch(segmentEvent, cb).then(function (ctx) {\n          _this.emit('track', name, ctx.event.properties, ctx.event.options);\n\n          return ctx;\n        })];\n      });\n    });\n  };\n\n  Analytics.prototype.page = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, category, page, properties, options, callback, segmentEvent;\n\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        _a = resolvePageArguments.apply(void 0, args), category = _a[0], page = _a[1], properties = _a[2], options = _a[3], callback = _a[4];\n        segmentEvent = this.eventFactory.page(category, page, properties, options, this.integrations);\n        return [2\n        /*return*/\n        , this.dispatch(segmentEvent, callback).then(function (ctx) {\n          _this.emit('page', category, page, ctx.event.properties, ctx.event.options);\n\n          return ctx;\n        })];\n      });\n    });\n  };\n\n  Analytics.prototype.identify = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, id, _traits, options, callback, segmentEvent;\n\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        _a = resolveUserArguments(this._user).apply(void 0, args), id = _a[0], _traits = _a[1], options = _a[2], callback = _a[3];\n\n        this._user.identify(id, _traits);\n\n        segmentEvent = this.eventFactory.identify(this._user.id(), this._user.traits(), options, this.integrations);\n        return [2\n        /*return*/\n        , this.dispatch(segmentEvent, callback).then(function (ctx) {\n          _this.emit('identify', ctx.event.userId, ctx.event.traits, ctx.event.options);\n\n          return ctx;\n        })];\n      });\n    });\n  };\n\n  Analytics.prototype.group = function () {\n    var _this = this;\n\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    if (args.length === 0) {\n      return this._group;\n    }\n\n    var _a = resolveUserArguments(this._group).apply(void 0, args),\n        id = _a[0],\n        _traits = _a[1],\n        options = _a[2],\n        callback = _a[3];\n\n    this._group.identify(id, _traits);\n\n    var groupId = this._group.id();\n\n    var groupTraits = this._group.traits();\n\n    var segmentEvent = this.eventFactory.group(groupId, groupTraits, options, this.integrations);\n    return this.dispatch(segmentEvent, callback).then(function (ctx) {\n      _this.emit('group', ctx.event.groupId, ctx.event.traits, ctx.event.options);\n\n      return ctx;\n    });\n  };\n\n  Analytics.prototype.alias = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, to, from, options, callback, segmentEvent;\n\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        _a = resolveAliasArguments.apply(void 0, args), to = _a[0], from = _a[1], options = _a[2], callback = _a[3];\n        segmentEvent = this.eventFactory.alias(to, from, options, this.integrations);\n        return [2\n        /*return*/\n        , this.dispatch(segmentEvent, callback).then(function (ctx) {\n          _this.emit('alias', to, from, ctx.event.options);\n\n          return ctx;\n        })];\n      });\n    });\n  };\n\n  Analytics.prototype.screen = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, category, page, properties, options, callback, segmentEvent;\n\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        _a = resolvePageArguments.apply(void 0, args), category = _a[0], page = _a[1], properties = _a[2], options = _a[3], callback = _a[4];\n        segmentEvent = this.eventFactory.screen(category, page, properties, options, this.integrations);\n        return [2\n        /*return*/\n        , this.dispatch(segmentEvent, callback).then(function (ctx) {\n          _this.emit('screen', category, page, ctx.event.properties, ctx.event.options);\n\n          return ctx;\n        })];\n      });\n    });\n  };\n\n  Analytics.prototype.trackClick = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var autotrack;\n\n      var _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , import(\n            /* webpackChunkName: \"auto-track\" */\n            '../auto-track')];\n\n          case 1:\n            autotrack = _b.sent();\n            return [2\n            /*return*/\n            , (_a = autotrack.link).call.apply(_a, __spreadArray([this], args, false))];\n        }\n      });\n    });\n  };\n\n  Analytics.prototype.trackLink = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var autotrack;\n\n      var _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , import(\n            /* webpackChunkName: \"auto-track\" */\n            '../auto-track')];\n\n          case 1:\n            autotrack = _b.sent();\n            return [2\n            /*return*/\n            , (_a = autotrack.link).call.apply(_a, __spreadArray([this], args, false))];\n        }\n      });\n    });\n  };\n\n  Analytics.prototype.trackSubmit = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var autotrack;\n\n      var _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , import(\n            /* webpackChunkName: \"auto-track\" */\n            '../auto-track')];\n\n          case 1:\n            autotrack = _b.sent();\n            return [2\n            /*return*/\n            , (_a = autotrack.form).call.apply(_a, __spreadArray([this], args, false))];\n        }\n      });\n    });\n  };\n\n  Analytics.prototype.trackForm = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var autotrack;\n\n      var _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , import(\n            /* webpackChunkName: \"auto-track\" */\n            '../auto-track')];\n\n          case 1:\n            autotrack = _b.sent();\n            return [2\n            /*return*/\n            , (_a = autotrack.form).call.apply(_a, __spreadArray([this], args, false))];\n        }\n      });\n    });\n  };\n\n  Analytics.prototype.register = function () {\n    var plugins = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      plugins[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var ctx, registrations;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            ctx = Context.system();\n            registrations = plugins.map(function (xt) {\n              return _this.queue.register(ctx, xt, _this);\n            });\n            return [4\n            /*yield*/\n            , Promise.all(registrations)];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , ctx];\n        }\n      });\n    });\n  };\n\n  Analytics.prototype.deregister = function () {\n    var plugins = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      plugins[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var ctx, deregistrations;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            ctx = Context.system();\n            deregistrations = plugins.map(function (pl) {\n              return __awaiter(_this, void 0, void 0, function () {\n                var plugin;\n                return __generator(this, function (_a) {\n                  plugin = this.queue.plugins.find(function (p) {\n                    return p.name === pl;\n                  });\n\n                  if (plugin) {\n                    return [2\n                    /*return*/\n                    , this.queue.deregister(ctx, plugin, this)];\n                  } else {\n                    ctx.log('warn', \"plugin \".concat(pl, \" not found\"));\n                  }\n\n                  return [2\n                  /*return*/\n                  ];\n                });\n              });\n            });\n            return [4\n            /*yield*/\n            , Promise.all(deregistrations)];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , ctx];\n        }\n      });\n    });\n  };\n\n  Analytics.prototype.debug = function (toggle) {\n    // Make sure legacy ajs debug gets turned off if it was enabled before upgrading.\n    if (toggle === false && localStorage.getItem('debug')) {\n      localStorage.removeItem('debug');\n    }\n\n    this._debug = toggle;\n    return this;\n  };\n\n  Analytics.prototype.reset = function () {\n    this._user.reset();\n  };\n\n  Analytics.prototype.timeout = function (timeout) {\n    this.settings.timeout = timeout;\n  };\n\n  Analytics.prototype.dispatch = function (event, callback) {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var ctx, startTime, dispatched, elapsedTime, timeoutInMs;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            ctx = new Context(event);\n            (_a = inspectorHost.triggered) === null || _a === void 0 ? void 0 : _a.call(inspectorHost, ctx);\n\n            if (isOffline() && !this.options.retryQueue) {\n              return [2\n              /*return*/\n              , ctx];\n            }\n\n            startTime = Date.now();\n            if (!this.queue.isEmpty()) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.queue.dispatchSingle(ctx)];\n\n          case 1:\n            dispatched = _b.sent();\n            return [3\n            /*break*/\n            , 4];\n\n          case 2:\n            return [4\n            /*yield*/\n            , this.queue.dispatch(ctx)];\n\n          case 3:\n            dispatched = _b.sent();\n            _b.label = 4;\n\n          case 4:\n            elapsedTime = Date.now() - startTime;\n            timeoutInMs = this.settings.timeout;\n            if (!callback) return [3\n            /*break*/\n            , 6];\n            return [4\n            /*yield*/\n            , invokeCallback(dispatched, callback, Math.max((timeoutInMs !== null && timeoutInMs !== void 0 ? timeoutInMs : 300) - elapsedTime, 0), timeoutInMs)];\n\n          case 5:\n            dispatched = _b.sent();\n            _b.label = 6;\n\n          case 6:\n            if (this._debug) {\n              dispatched.flush();\n            }\n\n            return [2\n            /*return*/\n            , dispatched];\n        }\n      });\n    });\n  };\n\n  Analytics.prototype.addSourceMiddleware = function (fn) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.queue.criticalTasks.run(function () {\n              return __awaiter(_this, void 0, void 0, function () {\n                var sourceMiddlewarePlugin, integrations, plugin;\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      return [4\n                      /*yield*/\n                      , import(\n                      /* webpackChunkName: \"middleware\" */\n                      '../../plugins/middleware')];\n\n                    case 1:\n                      sourceMiddlewarePlugin = _a.sent().sourceMiddlewarePlugin;\n                      integrations = {};\n                      this.queue.plugins.forEach(function (plugin) {\n                        if (plugin.type === 'destination') {\n                          return integrations[plugin.name] = true;\n                        }\n                      });\n                      plugin = sourceMiddlewarePlugin(fn, integrations);\n                      return [4\n                      /*yield*/\n                      , this.register(plugin)];\n\n                    case 2:\n                      _a.sent();\n\n                      return [2\n                      /*return*/\n                      ];\n                  }\n                });\n              });\n            })];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , this];\n        }\n      });\n    });\n  };\n  /* TODO: This does not have to return a promise? */\n\n\n  Analytics.prototype.addDestinationMiddleware = function (integrationName) {\n    var middlewares = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      middlewares[_i - 1] = arguments[_i];\n    }\n\n    var legacyDestinations = this.queue.plugins.filter(function (xt) {\n      // xt instanceof LegacyDestination &&\n      return xt.name.toLowerCase() === integrationName.toLowerCase();\n    });\n    legacyDestinations.forEach(function (destination) {\n      destination.addMiddleware.apply(destination, middlewares);\n    });\n    return Promise.resolve(this);\n  };\n\n  Analytics.prototype.setAnonymousId = function (id) {\n    return this._user.anonymousId(id);\n  };\n\n  Analytics.prototype.queryString = function (query) {\n    return __awaiter(this, void 0, void 0, function () {\n      var queryString;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , import(\n            /* webpackChunkName: \"queryString\" */\n            '../query-string')];\n\n          case 1:\n            queryString = _a.sent().queryString;\n            return [2\n            /*return*/\n            , queryString(this, query)];\n        }\n      });\n    });\n  };\n  /**\n   * @deprecated This function does not register a destination plugin.\n   *\n   * Instantiates a legacy Analytics.js destination.\n   *\n   * This function does not register the destination as an Analytics.JS plugin,\n   * all the it does it to invoke the factory function back.\n   */\n\n\n  Analytics.prototype.use = function (legacyPluginFactory) {\n    legacyPluginFactory(this);\n    return this;\n  };\n\n  Analytics.prototype.ready = function (callback) {\n    if (callback === void 0) {\n      callback = function (res) {\n        return res;\n      };\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , Promise.all(this.queue.plugins.map(function (i) {\n          return i.ready ? i.ready() : Promise.resolve();\n        })).then(function (res) {\n          callback(res);\n          return res;\n        })];\n      });\n    });\n  }; // analytics-classic api\n\n\n  Analytics.prototype.noConflict = function () {\n    console.warn(deprecationWarning);\n    window.analytics = _analytics !== null && _analytics !== void 0 ? _analytics : this;\n    return this;\n  };\n\n  Analytics.prototype.normalize = function (msg) {\n    console.warn(deprecationWarning);\n    return this.eventFactory.normalize(msg);\n  };\n\n  Object.defineProperty(Analytics.prototype, \"failedInitializations\", {\n    get: function () {\n      console.warn(deprecationWarning);\n      return this.queue.failedInitializations;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Analytics.prototype, \"VERSION\", {\n    get: function () {\n      return version;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /* @deprecated - noop */\n\n  Analytics.prototype.initialize = function (_settings, _options) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        console.warn(deprecationWarning);\n        return [2\n        /*return*/\n        , Promise.resolve(this)];\n      });\n    });\n  };\n\n  Analytics.prototype.pageview = function (url) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            console.warn(deprecationWarning);\n            return [4\n            /*yield*/\n            , this.page({\n              path: url\n            })];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , this];\n        }\n      });\n    });\n  };\n\n  Object.defineProperty(Analytics.prototype, \"plugins\", {\n    get: function () {\n      var _a;\n\n      console.warn(deprecationWarning); // @ts-expect-error\n\n      return (_a = this._plugins) !== null && _a !== void 0 ? _a : {};\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Analytics.prototype, \"Integrations\", {\n    get: function () {\n      console.warn(deprecationWarning);\n      var integrations = this.queue.plugins.filter(function (plugin) {\n        return plugin.type === 'destination';\n      }).reduce(function (acc, plugin) {\n        var name = \"\".concat(plugin.name.toLowerCase().replace('.', '').split(' ').join('-'), \"Integration\"); // @ts-expect-error\n\n        var integration = window[name];\n\n        if (!integration) {\n          return acc;\n        }\n\n        var nested = integration.Integration; // hack - Google Analytics function resides in the \"Integration\" field\n\n        if (nested) {\n          acc[plugin.name] = nested;\n          return acc;\n        }\n\n        acc[plugin.name] = integration;\n        return acc;\n      }, {});\n      return integrations;\n    },\n    enumerable: false,\n    configurable: true\n  }); // snippet function\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n  Analytics.prototype.push = function (args) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    var an = this;\n    var method = args.shift();\n\n    if (method) {\n      if (!an[method]) return;\n    }\n\n    an[method].apply(this, args);\n  };\n\n  return Analytics;\n}(Emitter);\n\nexport { Analytics };","map":{"version":3,"sources":["/Users/apple/Sites/react-typescript-template/node_modules/@segment/analytics-next/src/core/analytics/index.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  AliasParams,\n  DispatchedEvent,\n  EventParams,\n  PageParams,\n  resolveAliasArguments,\n  resolveArguments,\n  resolvePageArguments,\n  resolveUserArguments,\n  UserParams,\n} from '../arguments-resolver'\nimport type { FormArgs, LinkArgs } from '../auto-track'\nimport { invokeCallback } from '../callback'\nimport { isOffline } from '../connection'\nimport { Context } from '../context'\nimport { Emitter } from '@segment/analytics-core'\nimport {\n  Callback,\n  EventFactory,\n  Integrations,\n  Plan,\n  EventProperties,\n  SegmentEvent,\n} from '../events'\nimport { Plugin } from '../plugin'\nimport { EventQueue } from '../queue/event-queue'\nimport { CookieOptions, Group, ID, User, UserOptions } from '../user'\nimport autoBind from '../../lib/bind-all'\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted'\nimport type { LegacyDestination } from '../../plugins/ajs-destination'\nimport type { LegacyIntegration } from '../../plugins/ajs-destination/types'\nimport type {\n  DestinationMiddlewareFunction,\n  MiddlewareFunction,\n} from '../../plugins/middleware'\nimport { version } from '../../generated/version'\nimport { PriorityQueue } from '../../lib/priority-queue'\nimport { getGlobal } from '../../lib/get-global'\nimport { inspectorHost } from '../inspector'\nimport { AnalyticsClassic, AnalyticsSnippetCore } from './interfaces'\n\nconst deprecationWarning =\n  'This is being deprecated and will be not be available in future releases of Analytics JS'\n\n// reference any pre-existing \"analytics\" object so a user can restore the reference\nconst global: any = getGlobal()\nconst _analytics = global?.analytics\n\nfunction createDefaultQueue(retryQueue = false, disablePersistance = false) {\n  const maxAttempts = retryQueue ? 4 : 1\n  const priorityQueue = disablePersistance\n    ? new PriorityQueue(maxAttempts, [])\n    : new PersistedPriorityQueue(maxAttempts, 'event-queue')\n  return new EventQueue(priorityQueue)\n}\n\nexport interface AnalyticsSettings {\n  writeKey: string\n  timeout?: number\n  plugins?: Plugin[]\n}\n\nexport interface InitOptions {\n  /**\n   * Disables storing any data on the client-side via cookies or localstorage.\n   * Defaults to `false`.\n   *\n   */\n  disableClientPersistence?: boolean\n  initialPageview?: boolean\n  cookie?: CookieOptions\n  user?: UserOptions\n  group?: UserOptions\n  integrations?: Integrations\n  plan?: Plan\n  retryQueue?: boolean\n  obfuscate?: boolean\n}\n\n/* analytics-classic stubs */\nfunction _stub(this: never) {\n  console.warn(deprecationWarning)\n}\n\nexport class Analytics\n  extends Emitter\n  implements AnalyticsSnippetCore, AnalyticsClassic\n{\n  protected settings: AnalyticsSettings\n  private _user: User\n  private _group: Group\n  private eventFactory: EventFactory\n  private _debug = false\n\n  initialized = false\n  integrations: Integrations\n  options: InitOptions\n  queue: EventQueue\n\n  constructor(\n    settings: AnalyticsSettings,\n    options?: InitOptions,\n    queue?: EventQueue,\n    user?: User,\n    group?: Group\n  ) {\n    super()\n    const cookieOptions = options?.cookie\n    const disablePersistance = options?.disableClientPersistence ?? false\n    this.settings = settings\n    this.settings.timeout = this.settings.timeout ?? 300\n    this.queue =\n      queue ?? createDefaultQueue(options?.retryQueue, disablePersistance)\n    this._user =\n      user ??\n      new User(\n        disablePersistance\n          ? { ...options?.user, persist: false }\n          : options?.user,\n        cookieOptions\n      ).load()\n    this._group =\n      group ??\n      new Group(\n        disablePersistance\n          ? { ...options?.group, persist: false }\n          : options?.group,\n        cookieOptions\n      ).load()\n    this.eventFactory = new EventFactory(this._user)\n    this.integrations = options?.integrations ?? {}\n    this.options = options ?? {}\n\n    autoBind(this)\n  }\n\n  user = (): User => {\n    return this._user\n  }\n\n  async track(...args: EventParams): Promise<DispatchedEvent> {\n    const [name, data, opts, cb] = resolveArguments(...args)\n\n    const segmentEvent = this.eventFactory.track(\n      name,\n      data as EventProperties,\n      opts,\n      this.integrations\n    )\n\n    return this.dispatch(segmentEvent, cb).then((ctx) => {\n      this.emit('track', name, ctx.event.properties, ctx.event.options)\n      return ctx\n    })\n  }\n\n  async page(...args: PageParams): Promise<DispatchedEvent> {\n    const [category, page, properties, options, callback] =\n      resolvePageArguments(...args)\n\n    const segmentEvent = this.eventFactory.page(\n      category,\n      page,\n      properties,\n      options,\n      this.integrations\n    )\n\n    return this.dispatch(segmentEvent, callback).then((ctx) => {\n      this.emit('page', category, page, ctx.event.properties, ctx.event.options)\n      return ctx\n    })\n  }\n\n  async identify(...args: UserParams): Promise<DispatchedEvent> {\n    const [id, _traits, options, callback] = resolveUserArguments(this._user)(\n      ...args\n    )\n\n    this._user.identify(id, _traits)\n    const segmentEvent = this.eventFactory.identify(\n      this._user.id(),\n      this._user.traits(),\n      options,\n      this.integrations\n    )\n\n    return this.dispatch(segmentEvent, callback).then((ctx) => {\n      this.emit(\n        'identify',\n        ctx.event.userId,\n        ctx.event.traits,\n        ctx.event.options\n      )\n      return ctx\n    })\n  }\n\n  group(): Group\n  group(...args: UserParams): Promise<DispatchedEvent>\n  group(...args: UserParams): Promise<DispatchedEvent> | Group {\n    if (args.length === 0) {\n      return this._group\n    }\n\n    const [id, _traits, options, callback] = resolveUserArguments(this._group)(\n      ...args\n    )\n\n    this._group.identify(id, _traits)\n    const groupId = this._group.id()\n    const groupTraits = this._group.traits()\n\n    const segmentEvent = this.eventFactory.group(\n      groupId,\n      groupTraits,\n      options,\n      this.integrations\n    )\n\n    return this.dispatch(segmentEvent, callback).then((ctx) => {\n      this.emit('group', ctx.event.groupId, ctx.event.traits, ctx.event.options)\n      return ctx\n    })\n  }\n\n  async alias(...args: AliasParams): Promise<DispatchedEvent> {\n    const [to, from, options, callback] = resolveAliasArguments(...args)\n    const segmentEvent = this.eventFactory.alias(\n      to,\n      from,\n      options,\n      this.integrations\n    )\n    return this.dispatch(segmentEvent, callback).then((ctx) => {\n      this.emit('alias', to, from, ctx.event.options)\n      return ctx\n    })\n  }\n\n  async screen(...args: PageParams): Promise<DispatchedEvent> {\n    const [category, page, properties, options, callback] =\n      resolvePageArguments(...args)\n\n    const segmentEvent = this.eventFactory.screen(\n      category,\n      page,\n      properties,\n      options,\n      this.integrations\n    )\n    return this.dispatch(segmentEvent, callback).then((ctx) => {\n      this.emit(\n        'screen',\n        category,\n        page,\n        ctx.event.properties,\n        ctx.event.options\n      )\n      return ctx\n    })\n  }\n\n  async trackClick(...args: LinkArgs): Promise<Analytics> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.link.call(this, ...args)\n  }\n\n  async trackLink(...args: LinkArgs): Promise<Analytics> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.link.call(this, ...args)\n  }\n\n  async trackSubmit(...args: FormArgs): Promise<Analytics> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.form.call(this, ...args)\n  }\n\n  async trackForm(...args: FormArgs): Promise<Analytics> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.form.call(this, ...args)\n  }\n\n  async register(...plugins: Plugin[]): Promise<Context> {\n    const ctx = Context.system()\n\n    const registrations = plugins.map((xt) =>\n      this.queue.register(ctx, xt, this)\n    )\n    await Promise.all(registrations)\n\n    return ctx\n  }\n\n  async deregister(...plugins: string[]): Promise<Context> {\n    const ctx = Context.system()\n\n    const deregistrations = plugins.map(async (pl) => {\n      const plugin = this.queue.plugins.find((p) => p.name === pl)\n      if (plugin) {\n        return this.queue.deregister(ctx, plugin, this)\n      } else {\n        ctx.log('warn', `plugin ${pl} not found`)\n      }\n    })\n\n    await Promise.all(deregistrations)\n\n    return ctx\n  }\n\n  debug(toggle: boolean): Analytics {\n    // Make sure legacy ajs debug gets turned off if it was enabled before upgrading.\n    if (toggle === false && localStorage.getItem('debug')) {\n      localStorage.removeItem('debug')\n    }\n    this._debug = toggle\n    return this\n  }\n\n  reset(): void {\n    this._user.reset()\n  }\n\n  timeout(timeout: number): void {\n    this.settings.timeout = timeout\n  }\n\n  private async dispatch(\n    event: SegmentEvent,\n    callback?: Callback\n  ): Promise<DispatchedEvent> {\n    const ctx = new Context(event)\n\n    inspectorHost.triggered?.(ctx as any)\n\n    if (isOffline() && !this.options.retryQueue) {\n      return ctx\n    }\n\n    const startTime = Date.now()\n    let dispatched: Context\n    if (this.queue.isEmpty()) {\n      dispatched = await this.queue.dispatchSingle(ctx)\n    } else {\n      dispatched = await this.queue.dispatch(ctx)\n    }\n    const elapsedTime = Date.now() - startTime\n    const timeoutInMs = this.settings.timeout\n\n    if (callback) {\n      dispatched = await invokeCallback(\n        dispatched,\n        callback,\n        Math.max((timeoutInMs ?? 300) - elapsedTime, 0),\n        timeoutInMs\n      )\n    }\n    if (this._debug) {\n      dispatched.flush()\n    }\n\n    return dispatched\n  }\n\n  async addSourceMiddleware(fn: MiddlewareFunction): Promise<Analytics> {\n    await this.queue.criticalTasks.run(async () => {\n      const { sourceMiddlewarePlugin } = await import(\n        /* webpackChunkName: \"middleware\" */ '../../plugins/middleware'\n      )\n\n      const integrations: Record<string, boolean> = {}\n      this.queue.plugins.forEach((plugin) => {\n        if (plugin.type === 'destination') {\n          return (integrations[plugin.name] = true)\n        }\n      })\n\n      const plugin = sourceMiddlewarePlugin(fn, integrations)\n      await this.register(plugin)\n    })\n\n    return this\n  }\n\n  /* TODO: This does not have to return a promise? */\n  addDestinationMiddleware(\n    integrationName: string,\n    ...middlewares: DestinationMiddlewareFunction[]\n  ): Promise<Analytics> {\n    const legacyDestinations = this.queue.plugins.filter(\n      (xt) =>\n        // xt instanceof LegacyDestination &&\n        xt.name.toLowerCase() === integrationName.toLowerCase()\n    ) as LegacyDestination[]\n\n    legacyDestinations.forEach((destination) => {\n      destination.addMiddleware(...middlewares)\n    })\n    return Promise.resolve(this)\n  }\n\n  setAnonymousId(id?: string): ID {\n    return this._user.anonymousId(id)\n  }\n\n  async queryString(query: string): Promise<Context[]> {\n    const { queryString } = await import(\n      /* webpackChunkName: \"queryString\" */ '../query-string'\n    )\n    return queryString(this, query)\n  }\n\n  /**\n   * @deprecated This function does not register a destination plugin.\n   *\n   * Instantiates a legacy Analytics.js destination.\n   *\n   * This function does not register the destination as an Analytics.JS plugin,\n   * all the it does it to invoke the factory function back.\n   */\n  use(legacyPluginFactory: (analytics: Analytics) => void): Analytics {\n    legacyPluginFactory(this)\n    return this\n  }\n\n  async ready(\n    callback: Function = (res: Promise<unknown>[]): Promise<unknown>[] => res\n  ): Promise<unknown> {\n    return Promise.all(\n      this.queue.plugins.map((i) => (i.ready ? i.ready() : Promise.resolve()))\n    ).then((res) => {\n      callback(res)\n      return res\n    })\n  }\n\n  // analytics-classic api\n\n  noConflict(): Analytics {\n    console.warn(deprecationWarning)\n    window.analytics = _analytics ?? this\n    return this\n  }\n\n  normalize(msg: SegmentEvent): SegmentEvent {\n    console.warn(deprecationWarning)\n    return this.eventFactory.normalize(msg)\n  }\n\n  get failedInitializations(): string[] {\n    console.warn(deprecationWarning)\n    return this.queue.failedInitializations\n  }\n\n  get VERSION(): string {\n    return version\n  }\n\n  /* @deprecated - noop */\n  async initialize(\n    _settings?: AnalyticsSettings,\n    _options?: InitOptions\n  ): Promise<Analytics> {\n    console.warn(deprecationWarning)\n    return Promise.resolve(this)\n  }\n\n  init = this.initialize.bind(this)\n\n  async pageview(url: string): Promise<Analytics> {\n    console.warn(deprecationWarning)\n    await this.page({ path: url })\n    return this\n  }\n\n  get plugins() {\n    console.warn(deprecationWarning)\n    // @ts-expect-error\n    return this._plugins ?? {}\n  }\n\n  get Integrations() {\n    console.warn(deprecationWarning)\n    const integrations = this.queue.plugins\n      .filter((plugin) => plugin.type === 'destination')\n      .reduce((acc, plugin) => {\n        const name = `${plugin.name\n          .toLowerCase()\n          .replace('.', '')\n          .split(' ')\n          .join('-')}Integration`\n\n        // @ts-expect-error\n        const integration = window[name] as\n          | (LegacyIntegration & { Integration?: LegacyIntegration })\n          | undefined\n\n        if (!integration) {\n          return acc\n        }\n\n        const nested = integration.Integration // hack - Google Analytics function resides in the \"Integration\" field\n        if (nested) {\n          acc[plugin.name] = nested\n          return acc\n        }\n\n        acc[plugin.name] = integration as LegacyIntegration\n        return acc\n      }, {} as Record<string, LegacyIntegration>)\n\n    return integrations\n  }\n\n  log = _stub\n  addIntegrationMiddleware = _stub\n  listeners = _stub\n  addEventListener = _stub\n  removeAllListeners = _stub\n  removeListener = _stub\n  removeEventListener = _stub\n  hasListeners = _stub\n  add = _stub\n  addIntegration = _stub\n\n  // snippet function\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  push(args: any[]) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const an = this as any\n    const method = args.shift()\n    if (method) {\n      if (!an[method]) return\n    }\n    an[method].apply(this, args)\n  }\n}\n"]},"metadata":{},"sourceType":"module"}