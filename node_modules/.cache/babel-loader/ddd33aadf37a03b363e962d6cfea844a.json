{"ast":null,"code":"import { pickPrefix } from './pickPrefix';\nimport { gracefulDecodeURIComponent } from './gracefulDecodeURIComponent';\nexport function queryString(analytics, query) {\n  var a = document.createElement('a');\n  a.href = query;\n  var parsed = a.search.slice(1);\n  var params = parsed.split('&').reduce(function (acc, str) {\n    var _a = str.split('='),\n        k = _a[0],\n        v = _a[1];\n\n    acc[k] = gracefulDecodeURIComponent(v);\n    return acc;\n  }, {});\n  var calls = [];\n  var ajs_uid = params.ajs_uid,\n      ajs_event = params.ajs_event,\n      ajs_aid = params.ajs_aid;\n\n  if (ajs_aid) {\n    var anonId = Array.isArray(params.ajs_aid) ? params.ajs_aid[0] : params.ajs_aid;\n    analytics.setAnonymousId(anonId);\n  }\n\n  if (ajs_uid) {\n    var uid = Array.isArray(params.ajs_uid) ? params.ajs_uid[0] : params.ajs_uid;\n    var traits = pickPrefix('ajs_trait_', params);\n    calls.push(analytics.identify(uid, traits));\n  }\n\n  if (ajs_event) {\n    var event_1 = Array.isArray(params.ajs_event) ? params.ajs_event[0] : params.ajs_event;\n    var props = pickPrefix('ajs_prop_', params);\n    calls.push(analytics.track(event_1, props));\n  }\n\n  return Promise.all(calls);\n}","map":{"version":3,"sources":["/Users/apple/Sites/react-typescript-template/node_modules/@segment/analytics-next/src/core/query-string/index.ts"],"names":[],"mappings":"AAAA,SAAS,UAAT,QAA2B,cAA3B;AACA,SAAS,0BAAT,QAA2C,8BAA3C;AAQA,OAAM,SAAU,WAAV,CACJ,SADI,EAEJ,KAFI,EAES;AAEb,MAAM,CAAC,GAAG,QAAQ,CAAC,aAAT,CAAuB,GAAvB,CAAV;AACA,EAAA,CAAC,CAAC,IAAF,GAAS,KAAT;AACA,MAAM,MAAM,GAAG,CAAC,CAAC,MAAF,CAAS,KAAT,CAAe,CAAf,CAAf;AACA,MAAM,MAAM,GAAG,MAAM,CAAC,KAAP,CAAa,GAAb,EAAkB,MAAlB,CAAyB,UAAC,GAAD,EAAyB,GAAzB,EAA4B;AAC5D,QAAA,EAAA,GAAS,GAAG,CAAC,KAAJ,CAAU,GAAV,CAAT;AAAA,QAAC,CAAC,GAAA,EAAA,CAAA,CAAA,CAAF;AAAA,QAAI,CAAC,GAAA,EAAA,CAAA,CAAA,CAAL;;AACN,IAAA,GAAG,CAAC,CAAD,CAAH,GAAS,0BAA0B,CAAC,CAAD,CAAnC;AACA,WAAO,GAAP;AACD,GAJc,EAIZ,EAJY,CAAf;AAMA,MAAM,KAAK,GAAG,EAAd;AAEQ,MAAA,OAAO,GAAyB,MAAM,CAA/B,OAAP;AAAA,MAAS,SAAS,GAAc,MAAM,CAApB,SAAlB;AAAA,MAAoB,OAAO,GAAK,MAAM,CAAX,OAA3B;;AAER,MAAI,OAAJ,EAAa;AACX,QAAM,MAAM,GAAG,KAAK,CAAC,OAAN,CAAc,MAAM,CAAC,OAArB,IACX,MAAM,CAAC,OAAP,CAAe,CAAf,CADW,GAEX,MAAM,CAAC,OAFX;AAIA,IAAA,SAAS,CAAC,cAAV,CAAyB,MAAzB;AACD;;AAED,MAAI,OAAJ,EAAa;AACX,QAAM,GAAG,GAAG,KAAK,CAAC,OAAN,CAAc,MAAM,CAAC,OAArB,IACR,MAAM,CAAC,OAAP,CAAe,CAAf,CADQ,GAER,MAAM,CAAC,OAFX;AAGA,QAAM,MAAM,GAAG,UAAU,CAAC,YAAD,EAAe,MAAf,CAAzB;AAEA,IAAA,KAAK,CAAC,IAAN,CAAW,SAAS,CAAC,QAAV,CAAmB,GAAnB,EAAwB,MAAxB,CAAX;AACD;;AAED,MAAI,SAAJ,EAAe;AACb,QAAM,OAAK,GAAG,KAAK,CAAC,OAAN,CAAc,MAAM,CAAC,SAArB,IACV,MAAM,CAAC,SAAP,CAAiB,CAAjB,CADU,GAEV,MAAM,CAAC,SAFX;AAGA,QAAM,KAAK,GAAG,UAAU,CAAC,WAAD,EAAc,MAAd,CAAxB;AACA,IAAA,KAAK,CAAC,IAAN,CAAW,SAAS,CAAC,KAAV,CAAgB,OAAhB,EAAuB,KAAvB,CAAX;AACD;;AAED,SAAO,OAAO,CAAC,GAAR,CAAY,KAAZ,CAAP;AACD","sourcesContent":["import { pickPrefix } from './pickPrefix'\nimport { gracefulDecodeURIComponent } from './gracefulDecodeURIComponent'\nimport { Analytics } from '../analytics'\nimport { Context } from '../context'\n\nexport interface QueryStringParams {\n  [key: string]: string | null\n}\n\nexport function queryString(\n  analytics: Analytics,\n  query: string\n): Promise<Context[]> {\n  const a = document.createElement('a')\n  a.href = query\n  const parsed = a.search.slice(1)\n  const params = parsed.split('&').reduce((acc: QueryStringParams, str) => {\n    const [k, v] = str.split('=')\n    acc[k] = gracefulDecodeURIComponent(v)\n    return acc\n  }, {})\n\n  const calls = []\n\n  const { ajs_uid, ajs_event, ajs_aid } = params\n\n  if (ajs_aid) {\n    const anonId = Array.isArray(params.ajs_aid)\n      ? params.ajs_aid[0]\n      : params.ajs_aid\n\n    analytics.setAnonymousId(anonId)\n  }\n\n  if (ajs_uid) {\n    const uid = Array.isArray(params.ajs_uid)\n      ? params.ajs_uid[0]\n      : params.ajs_uid\n    const traits = pickPrefix('ajs_trait_', params)\n\n    calls.push(analytics.identify(uid, traits))\n  }\n\n  if (ajs_event) {\n    const event = Array.isArray(params.ajs_event)\n      ? params.ajs_event[0]\n      : params.ajs_event\n    const props = pickPrefix('ajs_prop_', params)\n    calls.push(analytics.track(event, props))\n  }\n\n  return Promise.all(calls)\n}\n"]},"metadata":{},"sourceType":"module"}